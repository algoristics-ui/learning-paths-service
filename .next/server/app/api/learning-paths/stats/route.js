"use strict";(()=>{var e={};e.id=218,e.ids=[218],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2254:e=>{e.exports=require("node:buffer")},6005:e=>{e.exports=require("node:crypto")},7261:e=>{e.exports=require("node:util")},2784:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>_,patchFetch:()=>A,requestAsyncStorage:()=>g,routeModule:()=>d,serverHooks:()=>E,staticGenerationAsyncStorage:()=>h});var r={};s.r(r),s.d(r,{GET:()=>l});var a=s(9303),n=s(8716),o=s(670),i=s(7070),p=s(4328),c=s(7435),u=s(9178);async function l(e){try{let t=await (0,u.S)(e);c.k.info(`Fetching learning path stats: userId=${t.userId}, organizationId=${t.organizationId}`);let s=`
      SELECT 
        COUNT(CASE WHEN ue.status = 'in_progress' THEN 1 END) as in_progress_count,
        COUNT(CASE WHEN ue.status = 'completed' THEN 1 END) as completed_count,
        COUNT(DISTINCT UNNEST(lp.skills)) as skills_gained,
        COUNT(CASE WHEN ue.status = 'completed' THEN 1 END) as certificates
      FROM user_enrollments ue
      JOIN learning_paths lp ON ue.path_id = lp.id
      WHERE ue.user_id = $1 AND lp.organization_id = $2
    `,r=await (0,p.I)(s,[t.userId,t.organizationId]),a={inProgressCount:parseInt(r.rows[0]?.in_progress_count||"0"),completedCount:parseInt(r.rows[0]?.completed_count||"0"),skillsGained:parseInt(r.rows[0]?.skills_gained||"0"),certificates:parseInt(r.rows[0]?.certificates||"0")};return c.k.info(`Learning path stats fetched successfully: userId=${t.userId}, stats=${JSON.stringify(a)}`),i.NextResponse.json({success:!0,data:a})}catch(e){if(c.k.error(`Error fetching learning path stats: ${e.message}`),"Missing Bearer token"===e.message||"Invalid token"===e.message)return i.NextResponse.json({success:!1,error:{code:"UNAUTHORIZED",message:e.message}},{status:401});return i.NextResponse.json({success:!1,error:{code:"INTERNAL_ERROR",message:"Failed to fetch learning path stats"}},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/learning-paths/stats/route",pathname:"/api/learning-paths/stats",filename:"route",bundlePath:"app/api/learning-paths/stats/route"},resolvedPagePath:"/Users/s1dando/LMS-Git/learning-paths-service/app/api/learning-paths/stats/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:g,staticGenerationAsyncStorage:h,serverHooks:E}=d,_="/api/learning-paths/stats/route";function A(){return(0,o.patchFetch)({serverHooks:E,staticGenerationAsyncStorage:h})}},9178:(e,t,s)=>{s.d(t,{S:()=>a});var r=s(6176);async function a(e){let t=e.headers.get("authorization")||"",s=t.startsWith("Bearer ")?t.slice(7):"",a=process.env.JWT_SECRET||"dev_jwt_secret_change_me";if(!s)throw Error("Missing Bearer token");try{let e=new TextEncoder,{payload:t}=await (0,r._)(s,e.encode(a));return{userId:t.userId,organizationId:t.organizationId,email:t.email}}catch{throw Error("Invalid token")}}},4328:(e,t,s)=>{s.d(t,{I:()=>p});let r=require("pg");var a=s(7410);let n=a.z.object({DATABASE_URL:a.z.string().min(1)}),o=process.env.DATABASE_URL?n.parse({DATABASE_URL:process.env.DATABASE_URL}):{DATABASE_URL:process.env.DATABASE_URL||"placeholder"},i=global.pgPoolLearningPaths||new r.Pool({connectionString:o.DATABASE_URL});async function p(e,t){return{rows:(await i.query(e,t)).rows}}global.pgPoolLearningPaths||(global.pgPoolLearningPaths=i)},7435:(e,t,s)=>{s.d(t,{k:()=>o});var r=s(6091);async function a(){let e=process.env.JWT_SECRET||"dev_jwt_secret_change_me",t=new TextEncoder;return await new r.N({sub:"learning-paths-service"}).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("10m").sign(t.encode(e))}async function n(e,t){let s=process.env.LOGGING_ENDPOINT||"http://localhost:4010/api/logs",r=await a();try{await fetch(s,{method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${r}`},body:JSON.stringify({app:"learning-paths-service",level:e,message:t})})}catch{}}let o={info:e=>n("INFO",e),debug:e=>n("DEBUG",e),warn:e=>n("WARN",e),error:e=>n("ERROR",e)}}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[276,972,410,524],()=>s(2784));module.exports=r})();