"use strict";(()=>{var e={};e.id=690,e.ids=[690],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2254:e=>{e.exports=require("node:buffer")},6005:e=>{e.exports=require("node:crypto")},7261:e=>{e.exports=require("node:util")},9237:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>A,patchFetch:()=>m,requestAsyncStorage:()=>g,routeModule:()=>u,serverHooks:()=>I,staticGenerationAsyncStorage:()=>h});var a={};t.r(a),t.d(a,{GET:()=>l});var s=t(9303),n=t(8716),o=t(670),i=t(7070),p=t(4328),d=t(7435),c=t(9178);async function l(e,{params:r}){try{let t=await (0,c.S)(e),a=parseInt(r.pathId);if(isNaN(a))return i.NextResponse.json({success:!1,error:{code:"VALIDATION_ERROR",message:"Invalid path ID"}},{status:400});d.k.info(`Fetching rewards for learning path: userId=${t.userId}, organizationId=${t.organizationId}, pathId=${a}`);let s=`
      SELECT lp.title, lp.badges, ue.status, ue.progress
      FROM learning_paths lp
      LEFT JOIN user_enrollments ue ON lp.id = ue.path_id AND ue.user_id = $2
      WHERE lp.id = $1 AND lp.organization_id = $3
    `,n=await (0,p.I)(s,[a,t.userId,t.organizationId]);if(0===n.rows.length)return i.NextResponse.json({success:!1,error:{code:"NOT_FOUND",message:"Learning path not found"}},{status:404});let o=n.rows[0],l=(o.badges||[]).map((e,r)=>({id:`badge-${a}-${r}`,name:e,description:`Earned by completing the ${o.title} learning path`,iconUrl:`https://storage.example.com/badges/${e.toLowerCase().replace(/\s+/g,"-")}.png`})),u=(o.progress||0)/100,g=Math.round(100*u),h="completed"===o.status&&(o.progress||0)>=100,I={badges:l,points:g,certificate:{available:h,title:`${o.title} Certificate`}};return d.k.info(`Rewards fetched successfully: userId=${t.userId}, pathId=${a}, rewardsCount=${l.length}, points=${g}, certificateAvailable=${h}`),i.NextResponse.json({success:!0,data:I})}catch(e){if(d.k.error(`Error fetching rewards: ${e.message}, pathId=${r.pathId}`),"Missing Bearer token"===e.message||"Invalid token"===e.message)return i.NextResponse.json({success:!1,error:{code:"UNAUTHORIZED",message:e.message}},{status:401});return i.NextResponse.json({success:!1,error:{code:"INTERNAL_ERROR",message:"Failed to fetch rewards"}},{status:500})}}let u=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/learning-paths/[pathId]/rewards/route",pathname:"/api/learning-paths/[pathId]/rewards",filename:"route",bundlePath:"app/api/learning-paths/[pathId]/rewards/route"},resolvedPagePath:"/Users/s1dando/LMS-Git/learning-paths-service/app/api/learning-paths/[pathId]/rewards/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:g,staticGenerationAsyncStorage:h,serverHooks:I}=u,A="/api/learning-paths/[pathId]/rewards/route";function m(){return(0,o.patchFetch)({serverHooks:I,staticGenerationAsyncStorage:h})}},9178:(e,r,t)=>{t.d(r,{S:()=>s});var a=t(6176);async function s(e){let r=e.headers.get("authorization")||"",t=r.startsWith("Bearer ")?r.slice(7):"",s=process.env.JWT_SECRET||"dev_jwt_secret_change_me";if(!t)throw Error("Missing Bearer token");try{let e=new TextEncoder,{payload:r}=await (0,a._)(t,e.encode(s));return{userId:r.userId,organizationId:r.organizationId,email:r.email}}catch{throw Error("Invalid token")}}},4328:(e,r,t)=>{t.d(r,{I:()=>p});let a=require("pg");var s=t(7410);let n=s.z.object({DATABASE_URL:s.z.string().min(1)}),o=process.env.DATABASE_URL?n.parse({DATABASE_URL:process.env.DATABASE_URL}):{DATABASE_URL:process.env.DATABASE_URL||"placeholder"},i=global.pgPoolLearningPaths||new a.Pool({connectionString:o.DATABASE_URL});async function p(e,r){return{rows:(await i.query(e,r)).rows}}global.pgPoolLearningPaths||(global.pgPoolLearningPaths=i)},7435:(e,r,t)=>{t.d(r,{k:()=>o});var a=t(6091);async function s(){let e=process.env.JWT_SECRET||"dev_jwt_secret_change_me",r=new TextEncoder;return await new a.N({sub:"learning-paths-service"}).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("10m").sign(r.encode(e))}async function n(e,r){let t=process.env.LOGGING_ENDPOINT||"http://localhost:4010/api/logs",a=await s();try{await fetch(t,{method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${a}`},body:JSON.stringify({app:"learning-paths-service",level:e,message:r})})}catch{}}let o={info:e=>n("INFO",e),debug:e=>n("DEBUG",e),warn:e=>n("WARN",e),error:e=>n("ERROR",e)}}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[276,972,410,524],()=>t(9237));module.exports=a})();